name: Cancel Queued Workflows
on:
  workflow_dispatch:
jobs:
  cancel:
    runs-on: ubuntu-latest
    steps:
      - name: Cancel Queued Workflows
        env:
          GITHUB_TOKEN: ${{ secrets.PAT }}
        run: |
          # Get queued workflow runs
          queued_runs=$(curl -s -H "Authorization: token $GITHUB_TOKEN" \
            -H "Accept: application/vnd.github.v3+json" \
            "https://api.github.com/repos/${{ github.repository }}/actions/runs?status=queued" \
            | jq -r '.workflow_runs[].id')

          # Cancel each queued run
          for run_id in $queued_runs; do
            curl -s -X POST \
              -H "Authorization: token $GITHUB_TOKEN" \
              -H "Accept: application/vnd.github.v3+json" \
              "https://api.github.com/repos/${{ github.repository }}/actions/runs/$run_id/cancel"
            echo "Cancelled queued workflow run $run_id"
          done