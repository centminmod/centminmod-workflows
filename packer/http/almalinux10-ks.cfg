#version=RHEL10

# System language and keyboard
en_US.UTF-8 UTF-8
keyboard us

# Network configuration (DHCP on first interface)
network --bootproto=dhcp --device=link --onboot=on --activate

timezone Australia/Brisbane --isUtc

# Root account
rootpw --plaintext changeme

# Optional non-root user
user --name=almalinux --groups=wheel --plaintext changeme --gecos "AlmaLinux User"
# Allow wheel group to sudo without password
%wheel ALL=(ALL) NOPASSWD: ALL

# Disk partitioning: LVM on entire disk
autopart --type=lvm

# Package selection
%packages
@^minimal-environment
cloud-init
NetworkManager
openssh-server
%end

# Post-install configuration
%post --log=/root/ks-post.log --interpreter=/usr/bin/bash
# Ensure SSH and network services start on boot
sed -i 's/^#\?PermitRootLogin.*/PermitRootLogin yes/' /etc/ssh/sshd_config
sed -i 's/^#\?PasswordAuthentication.*/PasswordAuthentication yes/' /etc/ssh/sshd_config
systemctl enable sshd
systemctl enable NetworkManager
systemctl enable cloud-final.service
%end
