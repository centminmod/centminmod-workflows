#version=RHEL10

# System language and keyboard
en_US.UTF-8 UTF-8
keyboard us

# Network configuration
network --bootproto=dhcp --device=link --onboot=on --activate

# Timezone
timezone Australia/Brisbane --isUtc

# Root password (replace with your own or use --iscrypted)
rootpw --plaintext changeme

# Optional user account
user --name=almalinux --groups=wheel --plaintext changeme --gecos "AlmaLinux User"
# Allow wheel group to sudo without password
%wheel ALL=(ALL) NOPASSWD: ALL

# Partitioning â€“ LVM layout on first disk
autopart --type=lvm

# Package selection\ n%packages
@^minimal-environment
cloud-init
%end

# Post-install configuration
%post --log=/root/ks-post.log --interpreter=/bin/bash
# Enable root SSH and password authentication
sed -i 's/^#\?PermitRootLogin.*/PermitRootLogin yes/' /etc/ssh/sshd_config
sed -i 's/^#\?PasswordAuthentication.*/PasswordAuthentication yes/' /etc/ssh/sshd_config

# Enable services
systemctl enable sshd.service
systemctl enable cloud-final.service
%end

# Reboot after installation
reboot
