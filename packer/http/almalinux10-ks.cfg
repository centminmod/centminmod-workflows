#version=RHEL10
text
lang en_US.UTF-8
keyboard us
timezone Australia/Brisbane --utc

# Network configuration
network --bootproto=dhcp --device=link --activate --onboot=yes

# Root password
rootpw --plaintext changeme

# System services
services --enabled="sshd,NetworkManager"

# Bootloader and console
bootloader --location=mbr --append="console=ttyS0,115200n8"

# Disk configuration
clearpart --all --initlabel
autopart --type=lvm

# Packages
%packages
@^minimal-environment
openssh-server
NetworkManager
%end

# Post-installation script
%post --log=/root/ks-post.log
echo "Starting post-installation tasks..."

# Configure SSH for root login
sed -i 's/^#\?PermitRootLogin.*/PermitRootLogin yes/' /etc/ssh/sshd_config
sed -i 's/^#\?PasswordAuthentication.*/PasswordAuthentication yes/' /etc/ssh/sshd_config

# Ensure services are enabled
systemctl enable sshd
systemctl enable NetworkManager

echo "Post-installation complete"
%end

# Reboot after installation
reboot --eject